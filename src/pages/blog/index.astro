---
import Layout from '@/layouts/Layout.astro';
import BlogPostCard from '@/components/BlogPostCard.astro';
import { getCollection } from 'astro:content';

const PAGE_SIZE = 10;
const allPosts = (await getCollection('blog'))
  .filter((p) => p.data.published !== false)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
const posts = allPosts.slice(0, PAGE_SIZE);
const totalPages = Math.ceil(allPosts.length / PAGE_SIZE);
const hasNext = totalPages > 1;
---

<Layout title="Blog">
  <section class="page-banner flex items-end pb-8 sm:pb-10">
    <div class="absolute inset-0 opacity-40 wopr-dot-grid" aria-hidden="true"></div>
    <div class="relative z-10 max-w-5xl mx-auto px-4 sm:px-6 w-full">
      <h1 class="page-title-on-banner">Blog</h1>
      <p class="mt-2 text-white/95 text-sm sm:text-base max-w-2xl">
        Tips, guides, and updates on support, security, and getting the most from your tech.
      </p>
    </div>
  </section>

  <div class="page-section">
    {posts.length === 0 ? (
      <p class="text-gray-600">No posts yet. Check back soon.</p>
    ) : (
      <ul class="space-y-6">
        {posts.map((entry) => (
          <BlogPostCard
            slug={entry.slug}
            title={entry.data.title}
            summary={entry.data.summary}
            date={entry.data.date}
            icon={entry.data.icon}
            image={entry.data.image}
            serviceIcon={entry.data.serviceIcon}
          />
        ))}
      </ul>
    )}

    {hasNext && (
      <p class="mt-10">
        <a href="/blog/page/2" class="text-sm font-medium text-[var(--wopr-secondary)] hover:text-[var(--wopr-primary)] hover:underline">
          Older posts â†’
        </a>
      </p>
    )}
  </div>
</Layout>
